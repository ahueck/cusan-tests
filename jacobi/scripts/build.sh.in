#!/bin/bash

export TYPEART_TYPE_FILE="@CUCORR_YAML_DIR@/types-jacobi.yaml"
export CUCORR_KERNEL_DATA_FILE="@CUCORR_YAML_DIR@/kernel-jacobi.yaml"

export CUCORR_MPICXX_EXEC="@cucorr_mpicxx@"
export CUCORR_MPICC_EXEC="@cucorr_mpicc@"

touch $TYPEART_TYPE_FILE
touch $CUCORR_KERNEL_DATA_FILE

preflag=$1
if [ ! -z "$preflag" ]; then
  export $preflag
  echo "Exported : $preflag"
fi

make all -j 1

if [ ! -z "$preflag" ]; then
  mv bin/jacobi_cuda_aware_mpi bin/jacobi_cuda_aware_mpi_vanilla
  mv bin/jacobi_cuda_normal_mpi bin/jacobi_cuda_normal_mpi_vanilla
fi