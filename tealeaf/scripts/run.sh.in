#!/bin/bash

export TYPEART_TYPE_FILE="@CUCORR_YAML_DIR@/types-tealeaf.yaml"
export CUCORR_KERNEL_DATA_FILE="@CUCORR_YAML_DIR@/kernel-tealeaf.yaml"

export TSAN_OPTIONS="exitcode=0 suppressions=@CUCORR_SUPPRESSION_DIR@/suppression-lb2.txt"


build_dir="build"
preflag=$1
if [ ! -z "$preflag" ]; then
  export $preflag
  echo "Exported : $preflag"
  build_dir="build_vanilla"
fi

if [ -z "$preflag" ]; then
    LD_PRELOAD="@lib_cucorr_interceptor@" /usr/bin/time -f "Time=%e" mpiexec -np 2 ./${build_dir}_cucorr/cuda-tealeaf 
else
    /usr/bin/time -f "Time=%e" mpiexec -np 2 ./${build_dir}_vanilla/cuda-tealeaf 
fi
